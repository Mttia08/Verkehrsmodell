<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Dies ist ein Verkehrsmodell, das den Benutzern erlaubt, die Anzahl der Reisenden zwischen Schweizer Bahnhöfen zu ermitteln.">
    <meta name="keywords" content="Verkehrsmodell, Schweiz, Anzahl Reisende, RailFlowCH, RailFlow, RailFlow-Modell">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="oIpkMsd5mGq-QSkyHtt9bEvnZgmMCJfznzzf05FpoHs">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/Mttia08/verkehrsmodell/main/icon.ico">
    <title>RailFlowCH</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: white;
            background-color: #2b2b2b;
        }

        input {
            padding: 5px;
            border-radius: 5px;
            border: none;
            color: white;
            background-color: #525252;
            outline: none;
        }

        button {
            padding: 5px;
            border-radius: 5px;
            border: none;
            color: white;
            background-color: #525252;
            cursor: pointer;
        }

        button:hover {
            background-color: #454545;
        }
    </style>
</head>
<body>
    <h1>RailFlowCH</h1>

    <form id="traveler-form">
        <label for="from">Von: </label>
        <input type="text" id="from" name="from" required><br><br>

        <label for="to">Nach: </label>
        <input type="text" id="to" name="to" required><br><br>

        <button type="button" onclick="calculateTravelers()">Berechnen</button>
    </form>

    <h2>Ergebnis</h2>
    <div id="result"></div>

    <script>
        // Function to fetch data from the JSON file
        async function getData() {
            const response = await fetch("https://raw.githubusercontent.com/Mttia08/Verkehrsmodell/main/ein_aussteiger.json");
            const data = await response.json();
            return data;
        }

        // Implementing the Haversine formula in JavaScript
        function haversine(coords1, coords2) {
            const R = 6371; // Radius of the Earth in km
            const lat1 = coords1[0];
            const lon1 = coords1[1];
            const lat2 = coords2[0];
            const lon2 = coords2[1];

            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;

            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c; // Distance in km
            return distance;
        }

        // Function to get all travelers from a station
        function getAllTravelers(station, data) {
            const out = {};
            const fromTravelers = data[station];
            let possibilities = [];

            for (const name in data) {
                if (name !== station) {
                    const distance = haversine(fromTravelers.coords, data[name].coords);
                    const value = Math.floor(data[name].dtv / distance);
                    const list_ = Array(value).fill(name);
                    possibilities = possibilities.concat(list_);
                    out[name] = 0;
                }
            }

            for (let i = 0; i < fromTravelers.dtv; i++) {
                const choice = possibilities[Math.floor(Math.random() * possibilities.length)];
                out[choice] += 10;
            }

            return Object.fromEntries(
                Object.entries(out).sort(([, a], [, b]) => b - a)
            );
        }

        // Function to calculate the number of travelers between two stations
        function getTravelers(from, to, data) {
            const dir1 = getAllTravelers(from, data)[to];
            const dir2 = getAllTravelers(to, data)[from];
            return Math.floor((dir1 + dir2) / 2);
        }

        // Function to handle the calculation when the form is submitted
        async function calculateTravelers() {
            const from = document.getElementById("from").value;
            const to = document.getElementById("to").value;

            if (!from || !to) {
                document.getElementById("result").innerHTML = "Bitte 'Von' und 'Nach' Bahnhof angeben.";
                return;
            }

            const data = await getData();

            if (!(from in data) || !(to in data)) {
                document.getElementById("result").innerHTML = "Ungültiger Bahnhof.";
                return;
            }

            const travelers = getTravelers(from, to, data);
            document.getElementById("result").innerHTML = `Geschätzte Anzahl Reisende zwischen ${from} und ${to}: ${travelers}`;
        }
    </script>
</body>
</html>
